<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Alke-Wallet - Movimientos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style> body { padding: 20px; background-color: #f8f9fa; } .container { max-width: 400px; margin: 0 auto; } </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Movimientos</h2>
        <span class="badge bg-primary">Historial</span>
    </div>

    <div class="card p-3 mb-3 shadow-sm">
        <label class="form-label fw-bold">Filtrar transacciones:</label>
        <select id="filtroTipo" class="form-select">
            <option value="todos">Ver Todos</option>
            <option value="Dep贸sito">Solo Dep贸sitos (Ingresos)</option>
            <option value="Env铆o">Solo Env铆os (Gastos)</option>
        </select>
    </div>

    <ul id="listaMovimientos" class="list-group shadow-sm">
        </ul>

    <a href="menu.html" class="btn btn-secondary mt-4 w-100">Volver al Men煤 Principal</a>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    $(document).ready(function() {
        // 1. OBTENER DATOS
        // Leemos el array guardado en LocalStorage. Si no hay nada, usamos array vac铆o []
        const historial = JSON.parse(localStorage.getItem('walletTransactions')) || [];

        // 2. FUNCIN DE RENDERIZADO (Dibuja la lista seg煤n un filtro)
        function renderizarLista(filtro) {
            const lista = $('#listaMovimientos');
            
            // .empty() limpia todo el HTML viejo dentro del UL antes de agregar lo nuevo
            lista.empty(); 

            // Caso borde: Si no hay historial
            if (historial.length === 0) {
                lista.append('<li class="list-group-item text-center text-muted">No hay movimientos registrados.</li>');
                return;
            }

            // Recorremos el array de historial
            // $.each es el bucle "for-each" de jQuery
            $.each(historial, function(index, mov) {
                
                // LGICA DE FILTRO:
                // 驴Debo mostrar este item? 
                // SI filtro es 'todos' -> SI
                // O SI el tipo del movimiento contiene la palabra clave (ej: "Env铆o") -> SI
                if (filtro === 'todos' || mov.tipo.includes(filtro)) {
                    
                    // L贸gica visual: Verde para ingresos, Rojo para gastos
                    const colorClass = mov.monto > 0 ? 'text-success' : 'text-danger';
                    const signo = mov.monto > 0 ? '+' : ''; // Agregamos signo + solo si es positivo

                    // Construimos el HTML como un String (Template literal)
                    const htmlItem = `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong class="text-dark">${mov.tipo}</strong><br>
                                <small class="text-muted" style="font-size: 0.85em;"> ${mov.fecha}</small>
                            </div>
                            <span class="${colorClass} fw-bold fs-5">
                                ${signo}$${Math.abs(mov.monto)}
                            </span>
                        </li>
                    `;
                    
                    // .append() inyecta este bloque HTML al final de la lista
                    lista.append(htmlItem);
                }
            });
            
            // Si despu茅s de filtrar no qued贸 nada (ej: filtr茅 dep贸sitos y no hay ninguno)
            if (lista.children().length === 0) {
                 lista.append('<li class="list-group-item text-center text-muted">No se encontraron resultados para este filtro.</li>');
            }
        }

        // 3. CARGA INICIAL
        // Llamamos a la funci贸n al abrir la p谩gina mostrando 'todos'
        renderizarLista('todos');

        // 4. EVENTO CHANGE (Filtrado din谩mico)
        // Detecta cuando el usuario cambia la opci贸n del <select>
        $('#filtroTipo').on('change', function() {
            const valorSeleccionado = $(this).val(); // Obtenemos el value del option ('todos', 'Dep贸sito', etc.)
            
            // Volvemos a dibujar la lista con el nuevo criterio
            renderizarLista(valorSeleccionado);
        });
    });
  </script>
</body>
</html>